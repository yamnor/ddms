---
title: 📘 実習③ | 最安定な格子定数を探す
---

前章では、１つの構造に対するエネルギーの計算を行いました。

しかし、研究の現場では「条件を変えて何回も計算する」ことも必要となります。本章では、格子定数を自動で変化させながら連続で第一原理計算を実行する「スキャン（Scan）」をおこないます。

## 課題：最も安定な構造となる格子定数を探す

物質は、エネルギーが最も低くなる構造（最安定構造）を取ろうとします。したがって、格子定数を変化させると、エネルギーは放物線状の変化を描くことが予想されます。

- **格子定数を小さくしすぎ**: 原子同士が反発してエネルギーが上昇
- **格子定数を大きくしすぎ**: 原子同士の結合が弱くなりエネルギーが上昇

![](https://gyazo.com/39ff61fc2a031b0ea66166b8d77f2703.jpeg)

放物線の「谷底」に対応する格子定数が、その物質に対するエネルギー的に安定な格子定数（**平衡格子定数**）となります。

手作業で少しずつ設定を変えながら計算を繰り返すことは大変です。これこそ、コンピュータを活用すべき作業です。

### スキャン範囲の定義

まず、「どの範囲を、どれくらいの細かさで」探索するか計画を立てます。シリコンの実験値 5.43 Å を中心に、±2% の範囲を11点でスキャンしてみましょう。±2% 程度の格子定数変化は、シリコンでは常圧近傍から数十 GPa 程度までの圧縮・引張に相当する「現実的なひずみ領域」のおおよそのイメージだと考えられます。

`numpy` という Python ライブラリの `linspace` 関数を使うと、等間隔の数値リストを手軽に準備できます。これを使って、格子定数のリストを作成します。

```python
import numpy as np

# 実験計画（スキャン条件）
symbol = 'Si'
a_exp = 5.43

# スキャン範囲: 0.98倍 ～ 1.02倍 を 11点で分割
scan_range = np.linspace(0.98, 1.02, 11)

# 実際の格子定数リストを作成
a_list = a_exp * scan_range

print("スキャンする格子定数 (Å):")
print(a_list)
```

**出力例:**

```term
スキャンする格子定数 (Å):
[5.3214, 5.34312, 5.36484, 5.38656, 5.40828, 5.43, 5.45172, 5.47344, 5.49516, 5.51688, 5.5386]
```

念のため、スキャンの出発点となる構造（格子定数 = 5.3214Å）を可視化してみましょう。

分子の立体構造を可視化する際には、`view(atoms, viewer='x3d')` を使うと、Google Colab上でもインタラクティブな3D表示が可能です。ここでは、`matplotlib` を使った静止画での可視化を行います。

```python
import matplotlib.pyplot as plt
from ase.build import bulk
from ase.visualize.plot import plot_atoms
from gpaw import GPAW, PW

# 最初の構造を可視化
atoms_sample = bulk('Si', 'diamond', a=a_list[0])
fig, ax = plt.subplots(figsize=(8, 4))
plot_atoms(atoms_sample, ax, radii=0.8, rotation=('45x,45y,0z'))
plt.title(f'Si Structure (a = {a_list[0]:.3f} Å)')
plt.axis('equal')
plt.axis('off')
plt.tight_layout()
plt.show()
```

**出力例:**

![](https://gyazo.com/dd983fd8efc04693086068a6b1329062.png)

X3Dビューワーを使用する場合は、以下のように記述します：

```python
from ase.visualize import view

# X3Dビューワーで表示（Google Colab上でも動作）
view(atoms_sample, viewer='x3d')
```

**出力例:**

![](https://gyazo.com/84f9e9d714a1466b0c5c2a41c37dbf12.png)

### スキャンのためのコード（forループ）

次に、スキャンのための Python コードを準備します。構造を作り、第一原理計算を実行し、記録するというサイクルを `for` ループで繰り返します。

```python
# 結果を格納する空のリスト
energies = []
volumes = []

# 自動化ループ
for a in a_list:
    # 構造の作成
    atoms = bulk('Si', 'diamond', a=a)
    
    # 計算エンジンのセットアップ
    #   本講義の実習における標準設定: PW(350), kpts=(4,4,4)
    #   毎回計算エンジンを定義し直すことで、クリーンな状態で計算します
    calc = GPAW(mode=PW(350),
                xc='PBE',
                kpts=(4, 4, 4),
                txt=None) # ログ出力を抑制して画面をすっきりさせる
    
    atoms.set_calculator(calc)
    
    # エネルギー計算を実行
    e = atoms.get_potential_energy()
    v = atoms.get_volume()
    
    # データを記録
    energies.append(e)
    volumes.append(v)
    
    print(f"Lattice: {a:.3f} Å, Energy: {e:.4f} eV")
```

**出力例:**

```term
Lattice: 5.321 Å, Energy: -10.7064 eV
Lattice: 5.343 Å, Energy: -10.7306 eV
Lattice: 5.365 Å, Energy: -10.7507 eV
Lattice: 5.387 Å, Energy: -10.7670 eV
Lattice: 5.408 Å, Energy: -10.7794 eV
Lattice: 5.430 Å, Energy: -10.7882 eV
Lattice: 5.452 Å, Energy: -10.7935 eV
Lattice: 5.473 Å, Energy: -10.7955 eV
Lattice: 5.495 Å, Energy: -10.7942 eV
Lattice: 5.517 Å, Energy: -10.7898 eV
Lattice: 5.539 Å, Energy: -10.7824 eV
```

### スキャンした結果の確認

スキャンが終わったら、収集したデータの中身（各格子定数ごとのエネルギーの値）を確認してみましょう。

```python
# データの内容を確認
print(f"スキャンしたデータ数: {len(energies)}")
print(f"エネルギーの最小値: {min(energies):.4f} eV")
```

**出力例：**

```term
スキャンしたデータ数: 11
エネルギーの最小値: -10.7955 eV
```

この結果に基づいて、エネルギーが最小値となる格子定数を特定してみます。

```python
# 平衡格子定数（エネルギーが最小となる格子定数）
min_energy_idx = energies.index(min(energies))
equilibrium_lattice = a_list[min_energy_idx]
print(f"平衡格子定数: {equilibrium_lattice:.3f} Å")
```

**出力例：**

```term
平衡格子定数: 5.473 Å
```

以上の結果から、シリコンが最も安定な構造を取るときの格子定数は 5.473 Å であることがわかりました。

次に、体積とエネルギーの関係をグラフとして表示してみます。

```python
# 体積とエネルギーの関係をグラフ化します
plt.figure(figsize=(8, 5))
plt.plot(volumes, energies, 'o-', label='DFT Data')
plt.xlabel('Volume ($\AA^3$)')
plt.ylabel('Potential Energy (eV)')
plt.title('Si Equation of State')
plt.grid(True)
plt.legend()
plt.show()
```

**出力例：**

![](https://gyazo.com/3c36772b59c7f8f8f0fd05744d339d90.png)

次章では、得られた「体積とエネルギーの対応データ」を解析し、体積弾性率を導出するプロセスについて説明します。